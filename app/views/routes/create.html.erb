<div class="container mt-5">
  <div class="text-center">
    <h1 class="display-5 fw-bold mb-4">ルート生成結果</h1>
    <div id="map" style="height: 500px; width: 100%;"></div>

    <div class="d-flex justify-content-center gap-3 mt-4">
      <button onclick="regenerateRoute()" class="btn btn-dark btn-primary btn-lg">ルートを再生成する</button>
      <button onclick="startWalk()" class="btn btn-dark btn-primary btn-lg">散歩する</button>
    </div>
  </div>
</div>

<script>
  // ルートデータをJavaScriptに渡す
  const routeData = <%= @route_data.to_json.html_safe %>;

  function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 14,
      center: { lat: routeData[0].latitude, lng: routeData[0].longitude }
    });

    const routeCoordinates = routeData.map(point => ({
      lat: point.latitude,
      lng: point.longitude
    }));

    const routePath = new google.maps.Polyline({
      path: routeCoordinates,
      geodesic: true,
      strokeColor: "#FF0000",
      strokeOpacity: 1.0,
      strokeWeight: 2
    });

    routePath.setMap(map);
  }

  window.onload = initMap;
</script>

<div id="map" style="height: 500px;"></div>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
<script>
function initMap(route) {
  const map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: route.points[0][1], lng: route.points[0][0] }, // 出発地
    zoom: 12,
  });

  const path = route.paths[0].points.coordinates.map(point => ({
    lat: point[1],
    lng: point[0],
  }));

  const routePath = new google.maps.Polyline({
    path: path,
    geodesic: true,
    strokeColor: "#FF0000",
    strokeOpacity: 1.0,
    strokeWeight: 2,
  });

  routePath.setMap(map);
}

// サーバーから受け取ったルートデータを描画
fetch('/generate-route', { method: 'GET' })
  .then(response => response.json())
  .then(route => initMap(route))
  .catch(error => console.error('エラー:', error));
</script>